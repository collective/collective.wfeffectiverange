<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="collective.wfeffectiverange">
<body>

<metal:custom_title fill-slot="content-title">
  <h1 class="documentFirstHeading" i18n:translate="heading_task_overview">Task Overview</h1>
</metal:custom_title>

<metal:content-core fill-slot="content-core">
<metal:block define-macro="content-core">

  <section tal:define="items view/items_effective">
    <h2 i18n:translate="label_workflow_tasks">Effective Tasks</h2>
    <a href="${context/absolute_url}/++add++WFTaskEffective" class="pat-plone-modal" i18n:translate="label_add_task">Add Task</a>

    <p tal:condition="not: items" i18n:translate="help_no_items">
      There are no tasks defined yet.
    </p>

    <tal:if condition="items">
    <table>
      <tal:loop repeat="item items">
      <tr tal:define="transitions item/common_transitions" data-uuid="${item/uuid}">
        <td>
          <div>
            <h3>${item/title}</h3>
            <a href="${item/url}/@@edit" class="pat-plone-modal" i18n:translate="label_edit">Edit</a>
          </div>
          <div tal:condition="item/task_items">
            <ul>
              <li tal:repeat="ob item/task_items">
                <a href="${ob/url}" class="state-${ob/state}" title="${ob/state}">${ob/title}</a> 
                <a href="${ob/url}/@@edit" class="pat-plone-modal" i18n:translate="label_edit">Edit</a>
                <a href="${view/protected_view_url}&task_uuid=${item/uuid}&ob_remove=${ob/intid}" i18n:translate="label_remove">Remove</a>
              </li>
            </ul>
          </div>
        </td>
        <td>
          <div>
            <select name="task_transition" tal:condition="transitions">
              <option value="" tal:attributes="selected python:'selected' if not item['transition'] else None" i18n:translate="option_make_selection">No transition selected</option>
              <tal:loop repeat="transition transitions">
              <option tal:define="id python:transition[0]; name python:transition[1]"  tal:attributes="selected python:'selected' if id==item['transition'] else None" value="${id}">${name}</option>
              </tal:loop>
            </select>
            <span tal:condition="not:transitions" i18n:translate="no_common_transitions">No common transitions possible</span>
          </div>
          <div tal:condition="item/task_items">
            <span tal:repeat="ob item/task_items" class="state-${ob/state}">${ob/state}</span>
          </div>
        </td>
        <td>
          <input name="task_date" type="datetime" class="pat-pickadate" value="${item/transition_date}"/>
        </td>
        <td>
          <input type="submit" value="Save" i18n:attributes="value label_save" />
          <a href="@@wftaskrunner?task_uid=${item/uuid}" class="pat-plone-modal" i18n:translate="label_run_now">Run Now</a>
        </td>
      </tr>
      </tal:loop>
    </table>
    </tal:if>
  </section>

</metal:block>
</metal:content-core>

</body>
</html>
